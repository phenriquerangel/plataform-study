<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Plataforma de Questões</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { margin-top: 40px; }
    input, textarea, select { margin-bottom: 10px; display: block; width: 100%; padding: 8px; }
    button { padding: 10px 15px; margin-top: 10px; }
    .container { max-width: 800px; margin: auto; }
    .question { border-bottom: 1px solid #ccc; padding: 10px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Plataforma de Questões</h1>

    <nav>
      <button onclick="mostrarAba('criar')">Criar Questão</button>
      <button onclick="mostrarAba('listar')">Listar Questões</button>
      <button onclick="mostrarAba('pdf')">Gerar PDF</button>
    </nav>

    <div id="aba-criar">
      <h2>Criar Questão</h2>
      <form id="formQuestao">
        <textarea placeholder="Texto da questão" id="texto" required></textarea>
        <input type="text" placeholder="Alternativa A" id="a" required>
        <input type="text" placeholder="Alternativa B" id="b" required>
        <input type="text" placeholder="Alternativa C" id="c" required>
        <input type="text" placeholder="Alternativa D" id="d" required>
        <select id="resposta">
          <option value="a">A</option>
          <option value="b">B</option>
          <option value="c">C</option>
          <option value="d">D</option>
        </select>
        <input type="text" placeholder="Origem (ex: ENEM01)" id="origem" required maxlength="7">
        <button type="submit">Salvar</button>
      </form>
      <div id="mensagem"></div>
    </div>

    <div id="aba-listar" style="display:none">
      <h2>Lista de Questões</h2>
      <div id="listaQuestoes"></div>
    </div>

    <div id="aba-pdf" style="display:none">
      <h2>Selecionar Questões para PDF</h2>
      <form id="formPdf">
        <div id="listaQuestoesPdf"></div>
        <button type="submit">Gerar PDF</button>
      </form>
    </div>
  </div>

  <script>
    const API_URL = 'http://api-questoes.api-questoes.svc.cluster.local/api';

    document.getElementById('formQuestao').onsubmit = async function(e) {
      e.preventDefault();
      const data = {
        texto: document.getElementById('texto').value,
        a: document.getElementById('a').value,
        b: document.getElementById('b').value,
        c: document.getElementById('c').value,
        d: document.getElementById('d').value,
        resposta: document.getElementById('resposta').value,
        origem: document.getElementById('origem').value
      };
      const res = await fetch(`${API_URL}/questoes/`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      if (res.ok) {
        document.getElementById('mensagem').innerText = 'Questão criada com sucesso!';
        document.getElementById('formQuestao').reset();
      } else {
        document.getElementById('mensagem').innerText = 'Erro ao criar questão.';
      }
    }

    async function carregarQuestoes(destino = "listaQuestoes") {
      const res = await fetch(`${API_URL}/questoes/`);
      const questoes = await res.json();
      const lista = document.getElementById(destino);
      lista.innerHTML = '';
      questoes.forEach(q => {
        const div = document.createElement('div');
        div.className = 'question';
        if (destino === "listaQuestoes") {
          div.innerHTML = `<strong>${q.texto}</strong><br>A) ${q.a}<br>B) ${q.b}<br>C) ${q.c}<br>D) ${q.d}<br><em>Resposta correta: ${q.resposta.toUpperCase()}</em><br><em>Origem: ${q.origem}</em><br><button onclick="deletarQuestao(${q.id})">Deletar</button>`;
        } else {
          div.innerHTML = `<input type="checkbox" name="questoes" value="${q.id}"> <strong>${q.texto}</strong>`;
        }
        lista.appendChild(div);
      });
    }

    async function deletarQuestao(id) {
      if (confirm("Deseja realmente deletar esta questão?")) {
        const res = await fetch(`${API_URL}/questoes/${id}`, {
          method: 'DELETE'
        });
        if (res.ok) carregarQuestoes();
        else alert("Erro ao deletar a questão.");
      }
    }

    function mostrarAba(aba) {
      document.getElementById('aba-criar').style.display = 'none';
      document.getElementById('aba-listar').style.display = 'none';
      document.getElementById('aba-pdf').style.display = 'none';
      document.getElementById('aba-' + aba).style.display = 'block';
      if (aba === 'listar') carregarQuestoes();
      if (aba === 'pdf') carregarQuestoes("listaQuestoesPdf");
    }

    document.getElementById('formPdf').onsubmit = async function(e) {
      e.preventDefault();
      const selecionadas = Array.from(document.querySelectorAll('input[name="questoes"]:checked')).map(el => parseInt(el.value));
      const res = await fetch(`${API_URL}/questoes/pdf`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ids: selecionadas })
      });
      if (res.ok) {
        const { status } = await res.json();
        alert(status);
      } else {
        alert('Erro ao gerar PDF');
      }
    }
  </script>
</body>
</html>
